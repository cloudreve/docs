# 本机存储 {#local-storage}

使用本机存储策略，将文件存放在与 Cloudreve 同一台服务器上。

## 配置 {#configure}

### 文件存储路径 {#file-storage-path}

你可以在存储策略配置中，修改 `Blob 存储目录` 来指定文件存储路径。默认情况下，新建的本机存储策略会使用 Cloudreve 程序同级目录下的 `data/uploads` 目录，你可以根据需要修改。如果填写相对路径，此路径也是相对于 Cloudreve 程序的所在的目录。

> [!TIP]
> 如果你在 Cloudreve 命令行参数中指定了 [`--use-working-dir`](../../overview/cli#global-parameters) 参数，相对路径的 `Blob 存储目录` 会相对于启动时的工作目录。

### 预分配硬盘空间 {#pre-allocate-disk-space}

在 Linux 或 macOS 系统上，开启 `预分配硬盘空间` 选项后，Cloudreve 会在上传开始时预分配硬盘空间，减少分片上传产生的碎片。

## 常见问题 {#faq}

::: details 上传的文件无法下载，缩略图也看不到。

1. 检查站点 URL 设置。

   确认下载文件生成的 URL 的主机名部分是否正确，请前往 `管理面板` -> `参数设置` -> `站点信息` 检查当前的站点 URL 是否在列表中。

   - 如果不在列表中，请将其加入列表，并前往 `管理面板` -> `参数设置` -> `文件系统`，点击底部的 `清除 Blob URL 缓存` 后重试下载。
   - 如果列表中存在，但下载链接中的主机名部分仍不正确，请确保你的 Web 服务器反代配置中正确呈递了 `Host` 头。比如在 Nginx 中，你需要在 `location /` 配置块中添加 `proxy_set_header Host $host;` 指令。

2. 排查是否在 HTTPS 环境下使用了 HTTP 的站点 URL。
3. 检查服务端时间是否和客户端时间相差较大，如果相差较大，请同步时间，并前往 `管理面板` -> `文件系统`，点击底部的 `清除 Blob URL 缓存` 后重试下载。

:::

::: details 文件下载链接中的 域名/主机名 并非我当前访问站点所使用的。
请前往 `管理面板` -> `参数设置` -> `站点信息` 检查当前的站点 URL 是否在列表中。

- 如果不在列表中，请将其加入列表，并前往 `管理面板` -> `文件系统`，点击底部的 `清除 Blob URL 缓存` 后重试下载。
- 如果列表中存在，但下载链接中的主机名部分仍不正确，请确保你的 Web 服务器反代配置中正确呈递了 `Host` 头。比如在 Nginx 中，你需要在 `location /` 配置块中添加 `proxy_set_header Host $host;` 指令。

:::

::: details 文件提示上传成功，但是文件列表中仍然展示为 `上传中`。
请检查是否有外部的 WAF 防火墙拦截了上传请求。
:::

::: details 文件上传失败，提示 `无法解析响应`。

1. 展开详细错误，检查错误信息中是否含有 `413 Request Entity Too Large` 字样。

   如果有，请修改 Nginx 反代配置，设定或增大 `client_max_body_size` 的值，比如 `client_max_body_size 20000m;`。如果开启了分片上传，此值应大于分片大小；如果未开启分片上传，此值应大于上传文件的大小。

2. 检查是否有外部 WAF 防火墙拦截了上传请求。

:::
