# Deploy with Docker {#deploy-with-docker}

## Prerequisites {#prerequisites}

Please refer to the [Docker installation documentation](https://docs.docker.com/install/) to install Docker.

## Get the Image {#get-image}

:::tabs
== Community Edition

You can find all available tags on the [cloudreve/cloudreve](https://hub.docker.com/r/cloudreve/cloudreve) repository page.

== Pro Edition

In the [Pro license management panel](https://cloudreve.org/login), click the `Get Docker Image` button to list currently available images, and generate an account for logging into the Pro edition private image registry, then use the `docker login` command to log in.

```bash
docker login -u obtained_username -p obtained_password cloudreve.azurecr.io
```

> [!NOTE]
> The container registry credentials you obtained are not permanently valid. If you encounter credential expiration issues when pulling images for future updates, please re-obtain and log in again.

:::

## Start {#start}

:::tabs
== Community Edition

```bash
docker run -d --name cloudreve -p 5212:5212 \
    -v ~/cloudreve/data:/cloudreve/data \
    cloudreve/cloudreve:latest
```

== Pro Edition

In the [Pro license management panel](https://cloudreve.org/login), click the `Get Authorization Key` button, and pass it through environment variables when starting the image.

```bash
docker run -d --name cloudreve -p 5212:5212 \
    -v ~/cloudreve/data:/cloudreve/data \
    -e CR_LICENSE_KEY=your_authorization_key \
    cloudreve.azurecr.io/cloudreve/pro:latest
```

:::

### Container Volume {#container-volume}

In the examples above, we mounted the host's `~/cloudreve/data` directory to the container's `/cloudreve/data` directory with `-v ~/cloudreve/data:/cloudreve/data`, to make it easier to modify Cloudreve configuration files on the host. All additional files generated by Cloudreve (avatars, configuration files, temporary directories, etc.) will be stored in this directory by default.

## Configure Database {#configure-database}

In the startup commands above, we haven't configured a database, so Cloudreve will use SQLite to store data. If you need Cloudreve to connect to other databases, you can choose one of the following methods:

:::tabs
== Configure at Container Startup

When starting the container, you can pass database configuration through environment variables:

```bash{3-8}
docker run -d --name cloudreve -p 5212:5212 \
    -v ~/cloudreve/data:/cloudreve/data \
    -e CR_CONF_Database.Type=postgres \
    -e CR_CONF_Database.Host=127.0.0.1 \
    -e CR_CONF_Database.Port=5432 \
    -e CR_CONF_Database.User=cloudreve \
    -e CR_CONF_Database.Password=cloudreve \
    -e CR_CONF_Database.Name=cloudreve \
    .....
```

The available configuration variables are:

| Variable Name                 | Description                                                                        |
| ----------------------------- | ---------------------------------------------------------------------------------- |
| `CR_CONF_Database.Type`       | Database type, supports `postgres`, `mysql`, `sqlite`                              |
| `CR_CONF_Database.Host`       | Database address                                                                   |
| `CR_CONF_Database.Port`       | Database port                                                                      |
| `CR_CONF_Database.User`       | Database username                                                                  |
| `CR_CONF_Database.Password`   | Database password                                                                  |
| `CR_CONF_Database.Name`       | Database name                                                                      |
| `CR_CONF_Database.DBFile`     | Optional, SQLite database file path                                                |
| `CR_CONF_Database.UnixSocket` | Optional, `true` or `false`, whether to use Unix Socket to connect to the database |

== Configure After Container Startup

After the container is started, you can add database configuration by modifying the `~/cloudreve/data/config.ini` file mounted on the host:

```ini{5-11}
[System]
Mode = master
Listen = :5212

[Database]
Type = mysql
Port = 3306
User = cloudreve
Password = cloudreve
Host = 127.0.0.1
Name = cloudreve
```

The available configuration items are:

| Setting Name | Description                                                                        |
| ------------ | ---------------------------------------------------------------------------------- |
| `Type`       | Database type, supports `postgres`, `mysql`, `sqlite`                              |
| `Host`       | Database address                                                                   |
| `Port`       | Database port                                                                      |
| `User`       | Database username                                                                  |
| `Password`   | Database password                                                                  |
| `Name`       | Database name                                                                      |
| `DBFile`     | Optional, SQLite database file path                                                |
| `UnixSocket` | Optional, `true` or `false`, whether to use Unix Socket to connect to the database |

After modifying the configuration file, you need to restart the container for the changes to take effect.

:::

## Configure Redis {#configure-redis}

In the startup commands above, we haven't configured Redis, so Cloudreve will use built-in memory storage. If you need Cloudreve to connect to Redis, you can choose one of the following methods:

:::tabs

=== Configure at Container Startup

When starting the container, you can pass Redis configuration through environment variables:

```bash{3-5}
docker run -d --name cloudreve -p 5212:5212 \
    -v ~/cloudreve/data:/cloudreve/data \
    -e CR_CONF_Redis.Server=127.0.0.1:6379 \
    -e CR_CONF_Redis.Password=your_redis_password \
    -e CR_CONF_Redis.DB=0 \
    cloudreve/cloudreve:latest
```

The available configuration variables are:

| Variable Name            | Description                                                                                                                                                                                                                |
| ------------------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `CR_CONF_Redis.Server`   | Redis address                                                                                                                                                                                                              |
| `CR_CONF_Redis.Password` | Connection password                                                                                                                                                                                                        |
| `CR_CONF_Redis.DB`       | Database number, default is `0`                                                                                                                                                                                            |
| `CR_CONF_Redis.Network`  | Network type, default is `tcp`, options include `tcp`, `tcp4` (IPv4-only), `tcp6` (IPv6-only), `udp`, `udp4` (IPv4-only), `udp6` (IPv6-only), `ip`, `ip4` (IPv4-only), `ip6` (IPv6-only), `unix`, `unixgram`, `unixpacket` |
| `CR_CONF_Redis.User`     | Redis ACL username                                                                                                                                                                                                         |

=== Configure After Container Startup

After the container is started, you can add Redis configuration by modifying the `~/cloudreve/data/config.ini` file mounted on the host:

```ini{5-8}
[System]
Mode = master
Listen = :5212

[Redis]
Server = 127.0.0.1:6379
Password = your_redis_password
DB = 0
```

The available configuration items are:

| Setting Name | Description                                                                                                                                                                                                                |
| ------------ | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `Server`     | Redis address                                                                                                                                                                                                              |
| `Password`   | Connection password                                                                                                                                                                                                        |
| `DB`         | Database number, default is `0`                                                                                                                                                                                            |
| `Network`    | Network type, default is `tcp`, options include `tcp`, `tcp4` (IPv4-only), `tcp6` (IPv6-only), `udp`, `udp4` (IPv4-only), `udp6` (IPv6-only), `ip`, `ip4` (IPv4-only), `ip6` (IPv6-only), `unix`, `unixgram`, `unixpacket` |
| `User`       | Redis ACL username                                                                                                                                                                                                         |

After modifying the configuration file, you need to restart the container for the changes to take effect.

:::

## Next Steps {#next-steps}

At this point, Cloudreve has started successfully and is listening on port 5212. Please continue to the [Next Steps](./configure) page to complete your deployment.

## Common Issues {#common-issues}

::: details Container cannot start?

First, find the restarting container, then check the logs:

```bash
docker logs -f cloudreve
```

The main reasons for Cloudreve abnormal exit during startup are configuration issues. You can find relevant clues in the container logs. Common errors include:

- Database configuration error;
- Redis configuration error;
- Authorization key error;

:::

::: details Cloudreve reports `Please specify license key by ...`

Please check whether you have correctly set the `CR_LICENSE_KEY` environment variable before starting. Its value should be the authorization key obtained from the [Pro license management panel](https://cloudreve.org/login).

:::

::: details I configured database or Redis when starting the container. How do I modify the configuration later?

Configuration items passed through environment variables when starting the container cannot be modified later by editing the `conf.ini` file. You can start a new container with the new configuration, just make sure to mount the `/cloudreve/data` to the same directory as the old container. That is, keep `-v ~/cloudreve/data:/cloudreve/data` unchanged.

:::

::: details How to update Cloudreve?

Since Cloudreve stores all configuration and data in the `/cloudreve/data` Volume, we just need to create a new container with the new image and mount the same Volume.

```bash{9}
# Stop the currently running container
docker stop cloudreve

# Remove the currently running container
docker rm cloudreve

# Create a new container with the new image and mount the same Volume
docker run -d --name cloudreve -p 5212:5212 \
    -v ~/cloudreve/data:/cloudreve/data \ # Make sure this is the same as the previous startup
    # Other configuration parameters, the same as the previous startup
    cloudreve/cloudreve:latest
```

You also need to refer to the [Update Cloudreve](./index) page to complete the subsequent process.

:::
